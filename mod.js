// deno-fmt-ignore-file
// deno-lint-ignore-file
var Q=class extends Error{name="AssertionError";constructor(t){super(t)}};function I(e,t=""){if(!e)throw new Q(t)}var{hasOwn:pe}=Object;function $(e,t){if(pe(e,t))return e[t]}function q(e,t){let n=$(e,t);return I(n!=null),n}function ae(e){return typeof e=="number"||/^0x[0-9a-f]+$/i.test(String(e))?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(String(e))}function K(e,t){let n=e;t.slice(0,-1).forEach(i=>{n=$(n,i)??{}});let r=t[t.length-1];return pe(n,r)}function Ve(e,{"--":t=!1,alias:n={},boolean:r=!1,default:i={},stopEarly:s=!1,string:l=[],collect:o=[],negatable:u=[],unknown:d=a=>a}={}){let a={},f={bools:{},strings:{},unknownFn:d,allBools:!1,collect:{},negatable:{}};if(n!==void 0)for(let h in n){let g=q(n,h);typeof g=="string"?a[h]=[g]:a[h]=g;for(let m of q(a,h))a[m]=[h].concat(a[h].filter(b=>m!==b))}if(r!==void 0)if(typeof r=="boolean")f.allBools=!!r;else{let h=typeof r=="string"?[r]:r;for(let g of h.filter(Boolean)){f.bools[g]=!0;let m=$(a,g);if(m)for(let b of m)f.bools[b]=!0}}if(l!==void 0){let h=typeof l=="string"?[l]:l;for(let g of h.filter(Boolean)){f.strings[g]=!0;let m=$(a,g);if(m)for(let b of m)f.strings[b]=!0}}if(o!==void 0){let h=typeof o=="string"?[o]:o;for(let g of h.filter(Boolean)){f.collect[g]=!0;let m=$(a,g);if(m)for(let b of m)f.collect[b]=!0}}if(u!==void 0){let h=typeof u=="string"?[u]:u;for(let g of h.filter(Boolean)){f.negatable[g]=!0;let m=$(a,g);if(m)for(let b of m)f.negatable[b]=!0}}let c={_:[]};function C(h,g){return f.allBools&&/^--[^=]+$/.test(g)||$(f.bools,h)||!!$(f.strings,h)||!!$(a,h)}function E(h,g,m,b=!0){let A=h,v=g.split(".");v.slice(0,-1).forEach(function(J){$(A,J)===void 0&&(A[J]={}),A=$(A,J)});let R=v[v.length-1];b&&!!$(f.collect,g)?$(A,R)===void 0?A[R]=[m]:Array.isArray($(A,R))?A[R].push(m):A[R]=[$(A,R),m]:A[R]=m}function y(h,g,m=void 0,b){if(m&&f.unknownFn&&!C(h,m)&&f.unknownFn(m,h,g)===!1)return;let A=!$(f.strings,h)&&ae(g)?Number(g):g;E(c,h,A,b);let v=$(a,h);if(v)for(let R of v)E(c,R,A,b)}function D(h){return q(a,h).some(g=>typeof $(f.bools,g)=="boolean")}let S=[];e.includes("--")&&(S=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(let h=0;h<e.length;h++){let g=e[h];if(/^--.+=/.test(g)){let m=g.match(/^--([^=]+)=(.*)$/s);I(m!=null);let[,b,A]=m;f.bools[b]?y(b,A!=="false",g):y(b,A,g)}else if(/^--no-.+/.test(g)&&$(f.negatable,g.replace(/^--no-/,""))){let m=g.match(/^--no-(.+)/);I(m!=null),y(m[1],!1,g,!1)}else if(/^--.+/.test(g)){let m=g.match(/^--(.+)/);I(m!=null);let[,b]=m,A=e[h+1];A!==void 0&&!/^-/.test(A)&&!$(f.bools,b)&&!f.allBools&&(!$(a,b)||!D(b))?(y(b,A,g),h++):/^(true|false)$/.test(A)?(y(b,A==="true",g),h++):y(b,$(f.strings,b)?"":!0,g)}else if(/^-[^-]+/.test(g)){let m=g.slice(1,-1).split(""),b=!1;for(let v=0;v<m.length;v++){let R=g.slice(v+2);if(R==="-"){y(m[v],R,g);continue}if(/[A-Za-z]/.test(m[v])&&/=/.test(R)){y(m[v],R.split(/=(.+)/)[1],g),b=!0;break}if(/[A-Za-z]/.test(m[v])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(R)){y(m[v],R,g),b=!0;break}if(m[v+1]&&m[v+1].match(/\W/)){y(m[v],g.slice(v+2),g),b=!0;break}else y(m[v],$(f.strings,m[v])?"":!0,g)}let[A]=g.slice(-1);!b&&A!=="-"&&(e[h+1]&&!/^(-|--)[^-]/.test(e[h+1])&&!$(f.bools,A)&&(!$(a,A)||!D(A))?(y(A,e[h+1],g),h++):e[h+1]&&/^(true|false)$/.test(e[h+1])?(y(A,e[h+1]==="true",g),h++):y(A,$(f.strings,A)?"":!0,g))}else if((!f.unknownFn||f.unknownFn(g)!==!1)&&c._.push(f.strings._??!ae(g)?g:Number(g)),s){c._.push(...e.slice(h+1));break}}for(let[h,g]of Object.entries(i))if(!K(c,h.split("."))&&(E(c,h,g,!1),a[h]))for(let m of a[h])E(c,m,g,!1);for(let h of Object.keys(f.bools))if(!K(c,h.split("."))){let g=$(f.collect,h)?[]:!1;E(c,h,g,!1)}for(let h of Object.keys(f.strings))!K(c,h.split("."))&&$(f.collect,h)&&E(c,h,[],!1);if(t){c["--"]=[];for(let h of S)c["--"].push(h)}else for(let h of S)c._.push(h);return c}var He=(()=>{let{Deno:e}=globalThis;if(typeof e?.build?.os=="string")return e.build.os;let{navigator:t}=globalThis;return t?.appVersion?.includes?.("Win")?"windows":"linux"})(),F=He==="windows",Je=47;function N(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function k(e){return e===47}function w(e){return k(e)||e===92}function T(e){return e>=97&&e<=122||e>=65&&e<=90}function Z(e,t,n,r){let i="",s=0,l=-1,o=0,u;for(let d=0,a=e.length;d<=a;++d){if(d<a)u=e.charCodeAt(d);else{if(r(u))break;u=Je}if(r(u)){if(!(l===d-1||o===1))if(l!==d-1&&o===2){if(i.length<2||s!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){let f=i.lastIndexOf(n);f===-1?(i="",s=0):(i=i.slice(0,f),s=i.length-1-i.lastIndexOf(n)),l=d,o=0;continue}else if(i.length===2||i.length===1){i="",s=0,l=d,o=0;continue}}t&&(i.length>0?i+=`${n}..`:i="..",s=2)}else i.length>0?i+=n+e.slice(l+1,d):i=e.slice(l+1,d),s=d-l-1;l=d,o=0}else u===46&&o!==-1?++o:o=-1}return i}function L(e,t){if(e.length<=1)return e;let n=e.length;for(let r=e.length-1;r>0&&t(e.charCodeAt(r));r--)n=r;return e.slice(0,n)}function ee(...e){let t="",n=!1;for(let r=e.length-1;r>=-1&&!n;r--){let i;if(r>=0)i=e[r];else{let{Deno:s}=globalThis;if(typeof s?.cwd!="function")throw new TypeError("Resolved a relative path without a CWD.");i=s.cwd()}N(i),i.length!==0&&(t=`${i}/${t}`,n=k(i.charCodeAt(0)))}return t=Z(t,!n,"/",k),n?t.length>0?`/${t}`:"/":t.length>0?t:"."}function B(...e){let t="",n="",r=!1;for(let i=e.length-1;i>=-1;i--){let s,{Deno:l}=globalThis;if(i>=0)s=e[i];else if(t){if(typeof l?.env?.get!="function"||typeof l?.cwd!="function")throw new TypeError("Resolved a relative path without a CWD.");s=l.cwd(),(s===void 0||s.slice(0,3).toLowerCase()!==`${t.toLowerCase()}\\`)&&(s=`${t}\\`)}else{if(typeof l?.cwd!="function")throw new TypeError("Resolved a drive-letter-less path without a CWD.");s=l.cwd()}N(s);let o=s.length;if(o===0)continue;let u=0,d="",a=!1,f=s.charCodeAt(0);if(o>1)if(w(f))if(a=!0,w(s.charCodeAt(1))){let c=2,C=c;for(;c<o&&!w(s.charCodeAt(c));++c);if(c<o&&c!==C){let E=s.slice(C,c);for(C=c;c<o&&w(s.charCodeAt(c));++c);if(c<o&&c!==C){for(C=c;c<o&&!w(s.charCodeAt(c));++c);c===o?(d=`\\\\${E}\\${s.slice(C)}`,u=c):c!==C&&(d=`\\\\${E}\\${s.slice(C,c)}`,u=c)}}}else u=1;else T(f)&&s.charCodeAt(1)===58&&(d=s.slice(0,2),u=2,o>2&&w(s.charCodeAt(2))&&(a=!0,u=3));else w(f)&&(u=1,a=!0);if(!(d.length>0&&t.length>0&&d.toLowerCase()!==t.toLowerCase())&&(t.length===0&&d.length>0&&(t=d),r||(n=`${s.slice(u)}\\${n}`,r=a),r&&t.length>0))break}return n=Z(n,!r,"\\",w),t+(r?"\\":"")+n||"."}function we(e){if(N(e),e.length===0)return"."}function re(e){we(e);let t=k(e.charCodeAt(0)),n=k(e.charCodeAt(e.length-1));return e=Z(e,!t,"/",k),e.length===0&&!t&&(e="."),e.length>0&&n&&(e+="/"),t?`/${e}`:e}function ie(e){we(e);let t=e.length,n=0,r,i=!1,s=e.charCodeAt(0);if(t>1)if(w(s))if(i=!0,w(e.charCodeAt(1))){let o=2,u=o;for(;o<t&&!w(e.charCodeAt(o));++o);if(o<t&&o!==u){let d=e.slice(u,o);for(u=o;o<t&&w(e.charCodeAt(o));++o);if(o<t&&o!==u){for(u=o;o<t&&!w(e.charCodeAt(o));++o);if(o===t)return`\\\\${d}\\${e.slice(u)}\\`;o!==u&&(r=`\\\\${d}\\${e.slice(u,o)}`,n=o)}}}else n=1;else T(s)&&e.charCodeAt(1)===58&&(r=e.slice(0,2),n=2,t>2&&w(e.charCodeAt(2))&&(i=!0,n=3));else if(w(s))return"\\";let l;return n<t?l=Z(e.slice(n),!i,"\\",w):l="",l.length===0&&!i&&(l="."),l.length>0&&w(e.charCodeAt(t-1))&&(l+="\\"),r===void 0?i?l.length>0?`\\${l}`:"\\":l.length>0?l:"":i?l.length>0?`${r}\\${l}`:`${r}\\`:l.length>0?r+l:r}function Ae(e){N(e);let t=e.length;if(t===0)return!1;let n=e.charCodeAt(0);return w(n)?!0:!!(T(n)&&t>2&&e.charCodeAt(1)===58&&w(e.charCodeAt(2)))}function be(e){return N(e),e.length>0&&k(e.charCodeAt(0))}function ye(...e){if(e.length===0)return".";let t;for(let n=0,r=e.length;n<r;++n){let i=e[n];N(i),i.length>0&&(t?t+=`/${i}`:t=i)}return t?re(t):"."}function Ce(...e){if(e.length===0)return".";let t,n=null;for(let s=0;s<e.length;++s){let l=e[s];N(l),l.length>0&&(t===void 0?t=n=l:t+=`\\${l}`)}if(t===void 0)return".";let r=!0,i=0;if(I(n!=null),w(n.charCodeAt(0))){++i;let s=n.length;s>1&&w(n.charCodeAt(1))&&(++i,s>2&&(w(n.charCodeAt(2))?++i:r=!1))}if(r){for(;i<t.length&&w(t.charCodeAt(i));++i);i>=2&&(t=`\\${t.slice(i)}`)}return ie(t)}function $e(e,t){if(N(e),N(t),e===t)return""}function qe(e,t){if($e(e,t),e=ee(e),t=ee(t),e===t)return"";let n=1,r=e.length;for(;n<r&&k(e.charCodeAt(n));++n);let i=r-n,s=1,l=t.length;for(;s<l&&k(t.charCodeAt(s));++s);let o=l-s,u=i<o?i:o,d=-1,a=0;for(;a<=u;++a){if(a===u){if(o>u){if(k(t.charCodeAt(s+a)))return t.slice(s+a+1);if(a===0)return t.slice(s+a)}else i>u&&(k(e.charCodeAt(n+a))?d=a:a===0&&(d=0));break}let c=e.charCodeAt(n+a),C=t.charCodeAt(s+a);if(c!==C)break;k(c)&&(d=a)}let f="";for(a=n+d+1;a<=r;++a)(a===r||k(e.charCodeAt(a)))&&(f.length===0?f+="..":f+="/..");return f.length>0?f+t.slice(s+d):(s+=d,k(t.charCodeAt(s))&&++s,t.slice(s))}function Ke(e,t){$e(e,t);let n=B(e),r=B(t);if(n===r||(e=n.toLowerCase(),t=r.toLowerCase(),e===t))return"";let i=0,s=e.length;for(;i<s&&e.charCodeAt(i)===92;++i);for(;s-1>i&&e.charCodeAt(s-1)===92;--s);let l=s-i,o=0,u=t.length;for(;o<u&&t.charCodeAt(o)===92;++o);for(;u-1>o&&t.charCodeAt(u-1)===92;--u);let d=u-o,a=l<d?l:d,f=-1,c=0;for(;c<=a;++c){if(c===a){if(d>a){if(t.charCodeAt(o+c)===92)return r.slice(o+c+1);if(c===2)return r.slice(o+c)}l>a&&(e.charCodeAt(i+c)===92?f=c:c===2&&(f=3));break}let E=e.charCodeAt(i+c),y=t.charCodeAt(o+c);if(E!==y)break;E===92&&(f=c)}if(c!==a&&f===-1)return r;let C="";for(f===-1&&(f=0),c=i+f+1;c<=s;++c)(c===s||e.charCodeAt(c)===92)&&(C.length===0?C+="..":C+="\\..");return C.length>0?C+r.slice(o+f,u):(o+=f,r.charCodeAt(o)===92&&++o,r.slice(o,u))}function Ye(e){return e}function Qe(e){if(typeof e!="string")return e;if(e.length===0)return"";let t=B(e);if(t.length>=3){if(t.charCodeAt(0)===92){if(t.charCodeAt(1)===92){let n=t.charCodeAt(2);if(n!==63&&n!==46)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(T(t.charCodeAt(0))&&t.charCodeAt(1)===58&&t.charCodeAt(2)===92)return`\\\\?\\${t}`}return e}function Ee(e){if(N(e),e.length===0)return"."}function et(e){Ee(e);let t=-1,n=!1;for(let r=e.length-1;r>=1;--r)if(k(e.charCodeAt(r))){if(n){t=r;break}}else n=!0;return t===-1?k(e.charCodeAt(0))?"/":".":L(e.slice(0,t),k)}function tt(e){Ee(e);let t=e.length,n=-1,r=-1,i=!0,s=0,l=e.charCodeAt(0);if(t>1)if(w(l)){if(n=s=1,w(e.charCodeAt(1))){let o=2,u=o;for(;o<t&&!w(e.charCodeAt(o));++o);if(o<t&&o!==u){for(u=o;o<t&&w(e.charCodeAt(o));++o);if(o<t&&o!==u){for(u=o;o<t&&!w(e.charCodeAt(o));++o);if(o===t)return e;o!==u&&(n=s=o+1)}}}}else T(l)&&e.charCodeAt(1)===58&&(n=s=2,t>2&&w(e.charCodeAt(2))&&(n=s=3));else if(w(l))return e;for(let o=t-1;o>=s;--o)if(w(e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;if(r===-1){if(n===-1)return".";r=n}return L(e.slice(0,r),k)}function ke(e,t){if(t.length>=e.length)return e;let n=e.length-t.length;for(let r=t.length-1;r>=0;--r)if(e.charCodeAt(n+r)!==t.charCodeAt(r))return e;return e.slice(0,-t.length)}function ve(e,t,n=0){let r=!1,i=e.length;for(let s=e.length-1;s>=n;--s)if(t(e.charCodeAt(s))){if(r){n=s+1;break}}else r||(r=!0,i=s+1);return e.slice(n,i)}function je(e,t){if(N(e),e.length===0)return e;if(typeof t!="string")throw new TypeError(`Suffix must be a string. Received ${JSON.stringify(t)}`)}function Re(e,t=""){je(e,t);let n=ve(e,k),r=L(n,k);return t?ke(r,t):r}function Ne(e,t=""){je(e,t);let n=0;if(e.length>=2){let s=e.charCodeAt(0);T(s)&&e.charCodeAt(1)===58&&(n=2)}let r=ve(e,w,n),i=L(r,w);return t?ke(i,t):i}function nt(e){N(e);let t=-1,n=0,r=-1,i=!0,s=0;for(let l=e.length-1;l>=0;--l){let o=e.charCodeAt(l);if(k(o)){if(!i){n=l+1;break}continue}r===-1&&(i=!1,r=l+1),o===46?t===-1?t=l:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===n+1?"":e.slice(t,r)}function rt(e){N(e);let t=0,n=-1,r=0,i=-1,s=!0,l=0;e.length>=2&&e.charCodeAt(1)===58&&T(e.charCodeAt(0))&&(t=r=2);for(let o=e.length-1;o>=t;--o){let u=e.charCodeAt(o);if(w(u)){if(!s){r=o+1;break}continue}i===-1&&(s=!1,i=o+1),u===46?n===-1?n=o:l!==1&&(l=1):n!==-1&&(l=-1)}return n===-1||i===-1||l===0||l===1&&n===i-1&&n===r+1?"":e.slice(n,i)}function De(e,t){let n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?r===e?n:n===t.root?n+r:n+e+r:r}function Se(e){if(e===null||typeof e!="object")throw new TypeError(`The "pathObject" argument must be of type Object. Received type ${typeof e}`)}function it(e){return Se(e),De("/",e)}function st(e){return Se(e),De("\\",e)}function ot(e){N(e);let t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;let n=k(e.charCodeAt(0)),r;n?(t.root="/",r=1):r=0;let i=-1,s=0,l=-1,o=!0,u=e.length-1,d=0;for(;u>=r;--u){let a=e.charCodeAt(u);if(k(a)){if(!o){s=u+1;break}continue}l===-1&&(o=!1,l=u+1),a===46?i===-1?i=u:d!==1&&(d=1):i!==-1&&(d=-1)}return i===-1||l===-1||d===0||d===1&&i===l-1&&i===s+1?(l!==-1&&(s===0&&n?t.base=t.name=e.slice(1,l):t.base=t.name=e.slice(s,l)),t.base=t.base||"/"):(s===0&&n?(t.name=e.slice(1,i),t.base=e.slice(1,l)):(t.name=e.slice(s,i),t.base=e.slice(s,l)),t.ext=e.slice(i,l)),s>0?t.dir=L(e.slice(0,s-1),k):n&&(t.dir="/"),t}function lt(e){N(e);let t={root:"",dir:"",base:"",ext:"",name:""},n=e.length;if(n===0)return t;let r=0,i=e.charCodeAt(0);if(n>1){if(w(i)){if(r=1,w(e.charCodeAt(1))){let f=2,c=f;for(;f<n&&!w(e.charCodeAt(f));++f);if(f<n&&f!==c){for(c=f;f<n&&w(e.charCodeAt(f));++f);if(f<n&&f!==c){for(c=f;f<n&&!w(e.charCodeAt(f));++f);f===n?r=f:f!==c&&(r=f+1)}}}}else if(T(i)&&e.charCodeAt(1)===58)if(r=2,n>2){if(w(e.charCodeAt(2))){if(n===3)return t.root=t.dir=e,t.base="\\",t;r=3}}else return t.root=t.dir=e,t}else if(w(i))return t.root=t.dir=e,t.base="\\",t;r>0&&(t.root=e.slice(0,r));let s=-1,l=r,o=-1,u=!0,d=e.length-1,a=0;for(;d>=r;--d){if(i=e.charCodeAt(d),w(i)){if(!u){l=d+1;break}continue}o===-1&&(u=!1,o=d+1),i===46?s===-1?s=d:a!==1&&(a=1):s!==-1&&(a=-1)}return s===-1||o===-1||a===0||a===1&&s===o-1&&s===l+1?o!==-1&&(t.base=t.name=e.slice(l,o)):(t.name=e.slice(l,s),t.base=e.slice(l,o),t.ext=e.slice(s,o)),t.base=t.base||"\\",l>0&&l!==r?t.dir=e.slice(0,l-1):t.dir=t.root,t}function Te(e){if(e=e instanceof URL?e:new URL(e),e.protocol!="file:")throw new TypeError("Must be a file URL.");return e}function Ie(e){return e=Te(e),decodeURIComponent(e.pathname.replace(/%(?![0-9A-Fa-f]{2})/g,"%25"))}function Pe(e){e=Te(e);let t=decodeURIComponent(e.pathname.replace(/\//g,"\\").replace(/%(?![0-9A-Fa-f]{2})/g,"%25")).replace(/^\\*([A-Za-z]:)(\\|$)/,"$1\\");return e.hostname!=""&&(t=`\\\\${e.hostname}${t}`),t}var ft={"	":"%09","\n":"%0A","\v":"%0B","\f":"%0C","\r":"%0D"," ":"%20"};function xe(e){return e.replaceAll(/[\s]/g,t=>ft[t]??t)}function ct(e){if(!be(e))throw new TypeError("Must be an absolute path.");let t=new URL("file:///");return t.pathname=xe(e.replace(/%/g,"%25").replace(/\\/g,"%5C")),t}function at(e){if(!Ae(e))throw new TypeError("Must be an absolute path.");let[,t,n]=e.match(/^(?:[/\\]{2}([^/\\]+)(?=[/\\](?:[^/\\]|$)))?(.*)/),r=new URL("file:///");if(r.pathname=xe(n.replace(/%/g,"%25")),t!=null&&t!="localhost"&&(r.hostname=t,!r.hostname))throw new TypeError("Invalid hostname.");return r}var ut="\\",dt=";",Fe={resolve:B,normalize:ie,isAbsolute:Ae,join:Ce,relative:Ke,toNamespacedPath:Qe,dirname:tt,basename:Ne,extname:rt,format:st,parse:lt,fromFileUrl:Pe,toFileUrl:at,sep:ut,delimiter:dt},ht="/",gt=":",Ue={resolve:ee,normalize:re,isAbsolute:be,join:ye,relative:qe,toNamespacedPath:Ye,dirname:et,basename:Re,extname:nt,format:it,parse:ot,fromFileUrl:Ie,toFileUrl:ct,sep:ht,delimiter:gt};function mt(e,t=""){return F?Ne(e,t):Re(e,t)}function pt(e){return F?Pe(e):Ie(e)}function wt(...e){return F?Ce(...e):ye(...e)}function Le(e){return F?ie(e):re(e)}var At=F?Fe:Ue,{join:Gt,normalize:_t}=At;F?Fe.delimiter:Ue.delimiter;async function bt(e){e=ze(e),e=Le(e);let t=mt(e),n=await Deno.stat(e);return{path:e,name:t,isFile:n.isFile,isDirectory:n.isDirectory,isSymlink:n.isSymlink}}function ze(e){return e instanceof URL?pt(e):e}var O=class extends Error{cause;name="WalkError";path;constructor(t,n){super(`${t instanceof Error?t.message:t} for path "${n}"`),this.path=n,this.cause=t}};function z(e,t,n,r){return!(t&&!t.some(i=>e.endsWith(i))||n&&!n.some(i=>!!e.match(i))||r&&r.some(i=>!!e.match(i)))}function yt(e,t){return e instanceof O?e:new O(e,t)}async function*We(e,{maxDepth:t=1/0,includeFiles:n=!0,includeDirs:r=!0,includeSymlinks:i=!0,followSymlinks:s=!1,exts:l=void 0,match:o=void 0,skip:u=void 0}={}){if(!(t<0)&&(e=ze(e),r&&z(e,l,o,u)&&(yield await bt(e)),!(t<1||!z(e,void 0,void 0,u))))try{for await(let d of Deno.readDir(e)){I(d.name!=null);let a=wt(e,d.name),{isSymlink:f,isDirectory:c}=d;if(f){if(!s){i&&z(a,l,o,u)&&(yield{path:a,...d});continue}a=await Deno.realPath(a),{isSymlink:f,isDirectory:c}=await Deno.lstat(a)}f||c?yield*We(a,{maxDepth:t-1,includeFiles:n,includeDirs:r,includeSymlinks:i,followSymlinks:s,exts:l,match:o,skip:u}):n&&z(a,l,o,u)&&(yield{path:a,...d})}}catch(d){throw yt(d,Le(e))}}var Ct={registryName:"deno.land",urlPrefix:"https://deno.land/",async fetchReleases(e){let t=await fetch(`https://apiland.deno.dev/v2/modules/${e}`);return t.ok?(await t.json()).versions:void 0},async fetchRepositoryUrl(e){if(e==="std")return"https://github.com/denoland/deno_std";let t=await fetch(`https://apiland.deno.dev/v2/metrics/modules/${e}`);return t.ok?`https://github.com/${(await t.json()).info.upload_options.repository}`:void 0},parseUrl(e){return e=e.replace("https://",""),{moduleName:e.startsWith("deno.land/std")?"std":e.split("/")[2].split("@")[0],version:e.startsWith("deno.land/std")?e.split("/")[1].split("@")[1]:e.split("/")[2].split("@")[1]}}},$t={registryName:"esm.sh",urlPrefix:"https://esm.sh/",async fetchReleases(e){let t=await fetch(`https://registry.npmjs.org/${e}`);if(!t.ok)return;let n=await t.json();return Object.keys(n.versions)},async fetchRepositoryUrl(e){let t=await fetch(`https://registry.npmjs.org/${e}`);return t.ok?(await t.json()).repository.url.replace(".git","").replace("git+",""):void 0},parseUrl(e){e=e.replace("https://","");let t=e.split("/")[1].split("@")[0];t.length===0&&(t=e.split("/")[1]+"/"+e.split("/")[2].split("@")[0]);let r=e.split("/")[1].split("@")[0].length===0?e.split("/")[2].split("@")[1]:e.split("/")[1].split("@")[1];return{moduleName:t,version:r}}},Et={registryName:"cdn.jsdelivr.net",urlPrefix:"https://cdn.jsdelivr.net/",async fetchReleases(e){if(e.includes("/")&&!e.startsWith("@")){let t=await fetch(`https://api.github.com/repos/${e}/releases`);return t.ok?(await t.json()).map(r=>r.tag_name):void 0}else{let t=await fetch(`https://registry.npmjs.org/${e}`);if(!t.ok)return;let n=await t.json();return Object.keys(n.versions)}},async fetchRepositoryUrl(e){if(e.includes("/")&&!e.startsWith("@"))return`https://github.com/${e}`;let t=await fetch(`https://registry.npmjs.org/${e}`);return t.ok?(await t.json()).repository.url.replace(".git","").replace("git+",""):void 0},parseUrl(e){if(e=e.replace("https://",""),e.startsWith("https://cdn.jsdelivr.net/gh/"))return{moduleName:e.split("/")[2]+"/"+e.split("/")[3].split("@")[0],version:e.split("/")[3].split("@")[1]};{let t=e.split("/")[2].split("@")[0],n=e.split("/")[2].split("@")[1];return t.length===0&&(t=e.split("/")[2]+"/"+e.split("/")[3].split("@")[0],n=e.split("/")[3].split("@")[1]),{moduleName:t,version:n}}}},M=[Ct,$t,Et];async function ue(...e){let t=[];for(let n of e)try{let{isFile:r,isDirectory:i}=await Deno.stat(n);if(r){let s=await de(n);if(!s)continue;t.push({filePath:n,urls:s})}else if(i)for await(let s of We(n)){let l=await de(s.path);l&&t.push({filePath:s.path,urls:l})}}catch{continue}return t}async function de(e){if(e.endsWith("deno.lock")||e.includes(".github/workflows/")&&(e.endsWith(".yml")||e.endsWith(".yaml")))return;let t=/(?:(?:(?:[a-z]+:)?\/\/)|www\.)(?:\S+(?::\S*)?@)?(?:localhost|(?:(?:[a-z\u00a1-\uffff0-9][-_]*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#][^\s"]*)?/gi;try{let r=(await Deno.readTextFile(e)).match(t);if(!r)return;let i=[];for(let s of r){if(s=s.replaceAll("'","").replaceAll('"',"").replace(")",""),M.some(o=>s===o.urlPrefix))continue;let l=M.filter(o=>s.startsWith(o.urlPrefix))[0];s.includes("${")||!l||i.push(s)}return i.length===0?void 0:i}catch{return}}var G=[],p=[],j=0,X=j++;p[X]="0|[1-9]\\d*";var Be=j++;p[Be]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var Oe=j++,Y=p[X];p[Oe]=`(${Y})\\.(${Y})\\.(${Y})`;var te=j++;p[te]="(?:"+p[X]+"|"+p[Be]+")";var se=j++;p[se]="(?:-("+p[te]+"(?:\\."+p[te]+")*))";var ne=j++;p[ne]="[0-9A-Za-z-]+";var oe=j++;p[oe]="(?:\\+("+p[ne]+"(?:\\."+p[ne]+")*))";var le=j++,Me="v?"+p[Oe]+p[se]+"?"+p[oe]+"?";p[le]="^"+Me+"$";var fe=j++;p[fe]="((?:<|>)?=?)";var W=j++;p[W]=p[X]+"|x|X|\\*";var P=j++;p[P]="[v=\\s]*("+p[W]+")(?:\\.("+p[W]+")(?:\\.("+p[W]+")(?:"+p[se]+")?"+p[oe]+"?)?)?";var kt=j++;p[kt]="^"+p[fe]+"\\s*"+p[P]+"$";var Ge=j++;p[Ge]="(?:~>?)";var vt=j++;p[vt]="^"+p[Ge]+p[P]+"$";var _e=j++;p[_e]="(?:\\^)";var jt=j++;p[jt]="^"+p[_e]+p[P]+"$";var Rt=j++;p[Rt]="^"+p[fe]+"\\s*("+Me+")$|^$";var Nt=j++;p[Nt]="^\\s*("+p[P]+")\\s+-\\s+("+p[P]+")\\s*$";var Dt=j++;p[Dt]="(<|>)?=?\\s*\\*";for(let e=0;e<j;e++)G[e]||(G[e]=new RegExp(p[e]));function _(e,t){if(typeof t!="object"&&(t={includePrerelease:!1}),e instanceof x)return e;if(typeof e!="string"||e.length>256||!G[le].test(e))return null;try{return new x(e,t)}catch{return null}}function St(e,t){if(e===null)return null;let n=_(e,t);return n?n.version:null}var x=class e{raw;options;major;minor;patch;version;build;prerelease;constructor(t,n){if(typeof n!="object"&&(n={includePrerelease:!1}),t instanceof e)t=t.version;else if(typeof t!="string")throw new TypeError("Invalid Version: "+t);if(t.length>256)throw new TypeError("version is longer than 256 characters");if(!(this instanceof e))return new e(t,n);this.options=n;let r=t.trim().match(G[le]);if(!r)throw new TypeError("Invalid Version: "+t);if(this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Number.MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Number.MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Number.MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<Number.MAX_SAFE_INTEGER)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format(),this.raw=this.version}format(t={}){let{style:n}=t,r=this.version=this.major+"."+this.minor+"."+this.patch;switch(this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),n){case"build":return[r,this.build.join(".")].filter(i=>i).join("+");case"full":return[this.version,this.build.join(".")].filter(i=>i).join("+");case"release":return r;case"prerelease":return this.version;default:return this.version}}compare(t){return t instanceof e||(t=new e(t,this.options)),this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof e||(t=new e(t,this.options)),U(this.major,t.major)||U(this.minor,t.minor)||U(this.patch,t.patch)}comparePre(t){if(t instanceof e||(t=new e(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{let r=this.prerelease[n],i=t.prerelease[n];if(r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return U(r,i)}while(++n);return 1}compareBuild(t){t instanceof e||(t=new e(t,this.options));let n=0;do{let r=this.build[n],i=t.build[n];if(r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return U(r,i)}while(++n);return 1}increment(t,n,r){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.increment("pre",n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.increment("pre",n);break;case"prepatch":this.prerelease.length=0,this.increment("patch",n),this.increment("pre",n);break;case"prerelease":this.prerelease.length===0&&this.increment("patch",n),this.increment("pre",n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);i===-1&&this.prerelease.push(0)}n&&(this.prerelease[0]===n?isNaN(this.prerelease[1])&&(this.prerelease=[n,0]):this.prerelease=[n,0]);break;default:throw new Error("invalid increment argument: "+t)}return this.build=r===void 0?this.build:r.split("."),this.format(),this.raw=this.version,this}toString(){return this.version}};function Ze(e,t,n){if(Tt(e,t,n))return null;{let r=_(e),i=_(t),s="",l=null;if(r&&i){(r.prerelease.length||i.prerelease.length)&&(s="pre",l="prerelease");for(let o in r)if((o==="major"||o==="minor"||o==="patch")&&r[o]!==i[o])return s+o}return l}}var he=/^[0-9]+$/;function U(e,t){let n=he.test(e),r=he.test(t);if(e===null||t===null)throw"Comparison against null invalid";return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1}function ce(e,t,n){return new x(e,n).compare(new x(t,n))}function Tt(e,t,n){return ce(e,t,n)===0}function It(e,t,n){return ce(e,t,n)>=0}var{Deno:ge}=globalThis,Pt=typeof ge?.noColor=="boolean"?ge.noColor:!1,xt=!Pt;function V(e,t){return{open:`\x1B[${e.join(";")}m`,close:`\x1B[${t}m`,regexp:new RegExp(`\\x1b\\[${t}m`,"g")}}function H(e,t){return xt?`${t.open}${e.replace(t.regexp,t.open)}${t.close}`:e}function Ft(e){return H(e,V([9],29))}function Ut(e){return H(e,V([37],39))}function Lt(e){return zt(e)}function zt(e){return H(e,V([90],39))}function Wt(e){return H(e,V([92],39))}new RegExp(["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|"),"g");async function Bt({allowBreaking:e=!1,allowUnstable:t=!1,createChangelog:n=!1,files:r,readonly:i=!1}){let s={"esm.sh":{},"deno.land":{},"cdn.jsdelivr.net":{}},l=new Map;for(let u of r){let d=[];for(let f of u.urls)try{if(f.endsWith("#pin"))continue;let c=M.filter(h=>f.startsWith(h.urlPrefix))[0],C=c.parseUrl(f);if(!C)continue;let{moduleName:E,version:y}=C;if(!St(y))continue;let D=l.get(c.registryName+":"+E);if(D||(D=await c.fetchReleases(E)),!D)continue;let S=Xe({currentVersion:y,versions:D,allowBreaking:e,allowUnstable:t});if(!S)continue;s[c.registryName][E]?s[c.registryName][E].push([y,S]):s[c.registryName][E]=[[y,S]],l.has(c.registryName+":"+E)||l.set(c.registryName+":"+E,D),d.push([f,f.replace(y,S)])}catch{continue}let a=await Deno.readTextFile(u.filePath);for(let[f,c]of d)a=a.replaceAll(f,c);i||await Deno.writeTextFile(u.filePath,a)}let o="";for(let[u,d]of Object.entries(s)){if(Object.keys(d).length===0)continue;o===""?o+=`- **${u}**

`:o+=`
- **${u}**

`;let a=[];for(let[f,c]of Object.entries(d))for(let C of c){let E=a.findIndex(y=>y.name===f&&y.from===C[0]&&y.to===C[1]);E>-1?a[E].count++:a.push({name:f,from:C[0],to:C[1],count:1})}for(let{name:f,from:c,to:C,count:E}of a){let y;try{y=await M.filter(S=>u===S.registryName)[0].fetchRepositoryUrl(f)}catch{}o+=`  - ${y?`[${f}](${y})`:f} \xD7 \`${c}\` \u2192 \`${me(c,C)}\`${E>1?` (x${E})`:""}
`,console.log(Lt(`${Ut(f)} \xD7 ${Ft(c)} \u2192 ${Wt(me(c,C))}`))}}return n&&!i&&await Deno.writeTextFile("./updates_changelog.md",o),s}function me(e,t){let n=Ze(e,t),r=_(t);return r?n?.startsWith("pre")?`\u{1F6A7} ${t}`:n==="major"?`\u26A0\uFE0F ${t}`:r.major===0?`\u{1F91E} ${t}`:t:t}function Xe(e){e.versions=e.versions.sort(ce);let t=e.versions[e.versions.length-1],n=Ze(e.currentVersion,t);if(!It(e.currentVersion,t)&&!(t===e.currentVersion||n===null))return(e.allowBreaking||e.allowUnstable)&&n==="major"||e.allowUnstable&&n.startsWith("pre")||n==="minor"||n==="patch"?t:(e.versions.pop(),Xe(e))}var Ot={url:"file:///C:/Users/Samuel/code/.deaddeno/update/mod.ts",main:import.meta.main};if(Ot.main){let e=Ve(Deno.args);e._=e._.filter(n=>typeof n=="string");let t=e._.length>0?await ue(...e._):await ue(Deno.cwd());await Bt({files:t,allowBreaking:e.breaking??e.b??!1,allowUnstable:e.unstable??e.u??!1,createChangelog:e.changelog??e.c??!1,readonly:e["dry-run"]??e.readonly??!1})}export{ue as analyze,Bt as update};
